basePath: /
definitions:
  controller.createTenantReq:
    properties:
      name:
        type: string
    required:
    - name
    type: object
  controller.introspectReq:
    properties:
      token:
        type: string
    type: object
  controller.listResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/controller.tenantResp'
        type: array
      page:
        type: integer
      page_size:
        type: integer
      total:
        type: integer
      total_pages:
        type: integer
    type: object
  controller.loginReq:
    properties:
      email:
        type: string
      password:
        type: string
      tenant_id:
        type: string
    required:
    - email
    - password
    - tenant_id
    type: object
  controller.magicSendReq:
    properties:
      email:
        type: string
      redirect_url:
        type: string
      tenant_id:
        type: string
    required:
    - email
    - tenant_id
    type: object
  controller.magicVerifyReq:
    properties:
      token:
        type: string
    required:
    - token
    type: object
  controller.mfaBackupConsumeReq:
    properties:
      code:
        type: string
    required:
    - code
    type: object
  controller.mfaBackupConsumeResp:
    properties:
      consumed:
        type: boolean
    type: object
  controller.mfaBackupCountResp:
    properties:
      count:
        type: integer
    type: object
  controller.mfaBackupGenerateReq:
    properties:
      count:
        maximum: 20
        minimum: 1
        type: integer
    type: object
  controller.mfaBackupGenerateResp:
    properties:
      codes:
        items:
          type: string
        type: array
    type: object
  controller.mfaChallengeResp:
    properties:
      challenge_token:
        type: string
      methods:
        items:
          type: string
        type: array
    type: object
  controller.mfaTOTPActivateReq:
    properties:
      code:
        type: string
    required:
    - code
    type: object
  controller.mfaTOTPStartResp:
    properties:
      otpauth_url:
        type: string
      secret:
        type: string
    type: object
  controller.mfaVerifyReq:
    properties:
      challenge_token:
        type: string
      code:
        type: string
      method:
        enum:
        - totp
        - backup_code
        type: string
    required:
    - challenge_token
    - code
    - method
    type: object
  controller.refreshReq:
    properties:
      refresh_token:
        type: string
    required:
    - refresh_token
    type: object
  controller.resetPasswordConfirmReq:
    properties:
      new_password:
        minLength: 8
        type: string
      tenant_id:
        type: string
      token:
        type: string
    required:
    - new_password
    - tenant_id
    - token
    type: object
  controller.resetPasswordRequestReq:
    properties:
      email:
        type: string
      tenant_id:
        type: string
    required:
    - email
    - tenant_id
    type: object
  controller.revokeReq:
    properties:
      token:
        type: string
      token_type:
        type: string
    required:
    - token
    - token_type
    type: object
  controller.signupReq:
    properties:
      email:
        type: string
      first_name:
        type: string
      last_name:
        type: string
      password:
        minLength: 8
        type: string
      tenant_id:
        type: string
    required:
    - email
    - password
    - tenant_id
    type: object
  controller.tenantResp:
    properties:
      created_at:
        type: string
      id:
        type: string
      is_active:
        type: boolean
      name:
        type: string
      updated_at:
        type: string
    type: object
  controller.tokensResp:
    properties:
      access_token:
        type: string
      refresh_token:
        type: string
    type: object
  domain.Introspection:
    properties:
      active:
        type: boolean
      email:
        type: string
      email_verified:
        type: boolean
      exp:
        type: integer
      iat:
        type: integer
      mfa_verified:
        type: boolean
      roles:
        items:
          type: string
        type: array
      tenant_id:
        type: string
      user_id:
        type: string
    type: object
  domain.UserProfile:
    properties:
      email:
        type: string
      email_verified:
        type: boolean
      first_name:
        type: string
      id:
        type: string
      last_login_at:
        type: string
      last_name:
        type: string
      mfa_enabled:
        type: boolean
      roles:
        items:
          type: string
        type: array
      tenant_id:
        type: string
    type: object
info:
  contact: {}
  description: Central Authentication Service for multi-tenant identity management.
  title: Guard CAS API
  version: "1.0"
paths:
  /tenants:
    get:
      description: Lists tenants with optional filters and pagination
      parameters:
      - description: Search query
        in: query
        name: q
        type: string
      - description: -1 any, 1 active, 0 inactive
        in: query
        name: active
        type: integer
      - description: Page number
        in: query
        name: page
        type: integer
      - description: Page size
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.listResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: List tenants
      tags:
      - tenants
    post:
      consumes:
      - application/json
      description: Creates a new tenant
      parameters:
      - description: name
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.createTenantReq'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/controller.tenantResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Create tenant
      tags:
      - tenants
  /tenants/{id}:
    get:
      description: Fetch a tenant by UUID
      parameters:
      - description: Tenant ID (UUID)
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.tenantResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get tenant by ID
      tags:
      - tenants
  /tenants/{id}/deactivate:
    patch:
      description: Deactivates a tenant by ID
      parameters:
      - description: Tenant ID (UUID)
        in: path
        name: id
        required: true
        type: string
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Deactivate tenant
      tags:
      - tenants
  /tenants/by-name/{name}:
    get:
      description: Fetch a tenant by unique name
      parameters:
      - description: Tenant name
        in: path
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.tenantResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get tenant by name
      tags:
      - tenants
  /v1/auth/introspect:
    post:
      consumes:
      - application/json
      description: Validate and parse JWT token either from Authorization header or
        request body
      parameters:
      - description: Token in body; otherwise uses Authorization Bearer
        in: body
        name: token
        schema:
          $ref: '#/definitions/controller.introspectReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/domain.Introspection'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Introspect access token
      tags:
      - auth.introspect
  /v1/auth/logout:
    post:
      consumes:
      - application/json
      description: Revokes the provided refresh token if present; idempotent
      parameters:
      - description: refresh_token (optional)
        in: body
        name: body
        schema:
          $ref: '#/definitions/controller.refreshReq'
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Logout (revoke refresh token)
      tags:
      - auth.tokens
  /v1/auth/magic/send:
    post:
      consumes:
      - application/json
      description: Sends a single-use magic login link to the user's email
      parameters:
      - description: tenant_id, email, optional redirect_url
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.magicSendReq'
      responses:
        "202":
          description: Accepted
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Send magic login link
      tags:
      - auth.magic
  /v1/auth/magic/verify:
    get:
      consumes:
      - application/json
      description: Verifies magic link token from query parameter or request body
        and returns tokens
      parameters:
      - description: Magic token (alternative to body)
        in: query
        name: token
        type: string
      - description: Magic token in JSON body
        in: body
        name: body
        schema:
          $ref: '#/definitions/controller.magicVerifyReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.tokensResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Verify magic link token
      tags:
      - auth.magic
    post:
      consumes:
      - application/json
      description: Verifies magic link token from query parameter or request body
        and returns tokens
      parameters:
      - description: Magic token (alternative to body)
        in: query
        name: token
        type: string
      - description: Magic token in JSON body
        in: body
        name: body
        schema:
          $ref: '#/definitions/controller.magicVerifyReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.tokensResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Verify magic link token
      tags:
      - auth.magic
  /v1/auth/me:
    get:
      description: Returns the authenticated user's profile derived from the access
        token
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/domain.UserProfile'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get current user's profile
      tags:
      - auth.profile
  /v1/auth/mfa/backup/consume:
    post:
      consumes:
      - application/json
      description: Consumes a single-use backup code
      parameters:
      - description: backup code
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.mfaBackupConsumeReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.mfaBackupConsumeResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Consume an MFA backup code
      tags:
      - auth.mfa.backup
  /v1/auth/mfa/backup/count:
    get:
      description: Returns number of unused backup codes
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.mfaBackupCountResp'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Count remaining MFA backup codes
      tags:
      - auth.mfa.backup
  /v1/auth/mfa/backup/generate:
    post:
      consumes:
      - application/json
      description: Generates backup codes, stores their hashes, and returns the codes
      parameters:
      - description: count (default 10, max 20)
        in: body
        name: body
        schema:
          $ref: '#/definitions/controller.mfaBackupGenerateReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.mfaBackupGenerateResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Generate MFA backup codes
      tags:
      - auth.mfa.backup
  /v1/auth/mfa/totp/activate:
    post:
      consumes:
      - application/json
      description: Verifies a TOTP code for the stored secret and enables MFA
      parameters:
      - description: TOTP code
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.mfaTOTPActivateReq'
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Activate TOTP
      tags:
      - auth.mfa.totp
  /v1/auth/mfa/totp/disable:
    post:
      description: Disables TOTP for the user
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Disable TOTP
      tags:
      - auth.mfa.totp
  /v1/auth/mfa/totp/start:
    post:
      description: Generates and stores a TOTP secret (disabled) and returns the secret
        and otpauth URL
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.mfaTOTPStartResp'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Start TOTP enrollment
      tags:
      - auth.mfa.totp
  /v1/auth/mfa/verify:
    post:
      consumes:
      - application/json
      description: Verifies a TOTP or backup code against a challenge token and returns
        access/refresh tokens.
      parameters:
      - description: challenge_token, method, and code
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.mfaVerifyReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.tokensResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Verify MFA challenge
      tags:
      - auth.mfa
  /v1/auth/password/login:
    post:
      consumes:
      - application/json
      description: Logs in with email/password. If MFA is enabled for the user, responds
        202 with a challenge to complete via /v1/auth/mfa/verify.
      parameters:
      - description: email/password
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.loginReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.tokensResp'
        "202":
          description: Accepted
          schema:
            $ref: '#/definitions/controller.mfaChallengeResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Password login
      tags:
      - auth.password
  /v1/auth/password/reset/confirm:
    post:
      consumes:
      - application/json
      description: Resets the password for the given email address
      parameters:
      - description: tenant_id, token, new_password
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.resetPasswordConfirmReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Confirm password reset
      tags:
      - auth.password
  /v1/auth/password/reset/request:
    post:
      consumes:
      - application/json
      description: Requests a password reset for the given email address
      parameters:
      - description: tenant_id, email
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.resetPasswordRequestReq'
      produces:
      - application/json
      responses:
        "202":
          description: Accepted
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Request password reset
      tags:
      - auth.password
  /v1/auth/password/signup:
    post:
      consumes:
      - application/json
      description: Creates a new user for a tenant with email and password and returns
        access/refresh tokens
      parameters:
      - description: tenant_id, email, password, optional first/last name
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.signupReq'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/controller.tokensResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Password signup
      tags:
      - auth.password
  /v1/auth/refresh:
    post:
      consumes:
      - application/json
      description: Exchanges a refresh token for new access and refresh tokens
      parameters:
      - description: refresh_token
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.refreshReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.tokensResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Refresh access token
      tags:
      - auth.tokens
  /v1/auth/revoke:
    post:
      consumes:
      - application/json
      description: Revoke a token; currently supports token_type="refresh"
      parameters:
      - description: token and token_type=refresh
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/controller.revokeReq'
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "429":
          description: Too Many Requests
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Revoke token
      tags:
      - auth.tokens
  /v1/auth/sso/{provider}/callback:
    get:
      description: Completes SSO flow and returns access/refresh tokens
      parameters:
      - description: SSO provider (google, github, azuread)
        in: path
        name: provider
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/controller.tokensResp'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Handle SSO/OAuth callback
      tags:
      - auth.sso
  /v1/auth/sso/{provider}/start:
    get:
      description: Initiates an SSO flow for the given provider and redirects to the
        provider authorization URL
      parameters:
      - description: SSO provider (google, github, azuread)
        in: path
        name: provider
        required: true
        type: string
      - description: Tenant ID (UUID)
        in: query
        name: tenant_id
        required: true
        type: string
      - description: Absolute redirect URL after callback
        in: query
        name: redirect_url
        type: string
      - description: Opaque state to round-trip
        in: query
        name: state
        type: string
      - description: Provider connection identifier
        in: query
        name: connection_id
        type: string
      - description: Organization identifier
        in: query
        name: organization_id
        type: string
      responses:
        "302":
          description: Found
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Start SSO/OAuth flow
      tags:
      - auth.sso
schemes:
- http
securityDefinitions:
  BearerAuth:
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
