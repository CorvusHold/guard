{
  "name": "Password login 202 (MFA) -> mfa/verify 200 -> me 200",
  "setup": { "waitMs": 1000 },
  "requiresEnv": ["TENANT_ID", "EMAIL", "PASSWORD", "TOTP_CODE"],
  "steps": [
    {
      "request": {
        "method": "POST",
        "path": "/api/v1/auth/password/login",
        "headers": { "content-type": "application/json" },
        "body": {
          "tenant_id": "{{TENANT_ID}}",
          "email": "{{EMAIL}}",
          "password": "{{PASSWORD}}"
        }
      },
      "expect": {
        "status": 202
      },
      "store": {
        "CHALLENGE_TOKEN": "challenge_token"
      }
    },
    {
      "request": {
        "method": "POST",
        "path": "/api/v1/auth/mfa/verify",
        "headers": { "content-type": "application/json" },
        "body": {
          "method": "totp",
          "code": "{{TOTP_CODE}}",
          "challenge_token": "{{CHALLENGE_TOKEN}}"
        }
      },
      "expect": {
        "status": 200,
        "bodyContains": { "access_token": {}, "refresh_token": {} }
      },
      "store": {
        "ACCESS_TOKEN": "access_token",
        "REFRESH_TOKEN": "refresh_token"
      }
    },
    {
      "request": {
        "method": "GET",
        "path": "/api/v1/auth/me",
        "headers": { "authorization": "Bearer {{ACCESS_TOKEN}}" }
      },
      "expect": { "status": 200 }
    }
  ]
}
